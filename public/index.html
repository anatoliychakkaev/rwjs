<!DOCTYPE html>
<html>
  <head>
    <title>RailwayJS</title>

    <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css">
    <link href="/javascripts/prettyprint/prettify.css" rel="stylesheet">

    <script type="text/javascript" src="/javascripts/prettyprint/prettify.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://twitter.github.com/bootstrap/1.3.0/bootstrap-scrollspy.js"></script>
    <script>$(function () { prettyPrint() })</script>

    <style>
      section {
        padding-top: 60px;
      }
    </style>

  </head>
  <body style="padding-top: 60px">
    <a href="http://github.com/1602/express-on-railway"><img style="position: fixed; top: 0; right: 0; border: 0;z-index: 10001;" src="https://d3nwyuy0nl342s.cloudfront.net/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>
    <div class="topbar-wrapper" style="z-index: 5;">
      <div class="topbar" data-scrollspy="scrollspy">
        <div class="topbar-inner">
          <div class="container">
            <h3><a href="#">RailwayJS</a></h3>
            <ul class="nav">
              <li><a href="#about">About</a></li><li><a href="#routing">Routing</a></li><li><a href="#controller">Controller</a></li><li><a href="#views">Views</a></li><li><a href="#generators">Generators</a></li><li><a href="#console">Console</a></li><li><a href="#coffee">Coffee</a></li><li><a href="#localization">Localization</a></li><li><a href="#extensions">Extensions</a></li><li><a href="#heroku">Heroku</a></li><li><a href="#snippets">Snippets</a></li>
              <!--li class="dropdown">
                <a href="#" class="dropdown-toggle">Features</a>
                <ul class="dropdown-menu">
                  <li><a href="#">Extensions</a></li>
                  <li><a href="#">Coffee</a></li>
                  <li class="divider"></li>
                  <li><a href="#">Contributing</a></li>
                </ul>
              </li-->
            </ul>
          </div>
        </div><!-- /topbar-inner -->
      </div><!-- /topbar -->
    </div><!-- /topbar-wrapper -->

<div class="container">
  <h1 style="text-align: center; font-size: 250%; position: relative; top: 30px;"><span style="color: #a24;">RightwayJS - MVC framework</span><br/><small>Create NodeJS web apps faster with more energy, using RailwayJS</small></h1>

  
<section id="about"><div class="page-header">

<h1>About Railway <small>Objective, getting started, technical details</small></h1>

</div>

<div class="row">

<div class="span-one-third">

<h3>What is railway?</h3>

<p>Railway is the Node.JS MVC framework based on <a href="http://expressjs.com/guide">ExpressJS</a>, fully <strong>ExpressJS-compatible</strong>. It allows you to build web applications in a similar manner as in Ruby On Rails.</p>

<p>The main objective of the framework - web development without pain.</p>

<h3>Related links</h3>

<ul>
<li><a href="https://github.com/1602/express-on-railway/issues">Have spotted bug? Report!</a></li>
<li><a href="http://groups.google.com/group/railwayjs">RailwayJS Google Group</a></li>
<li><a href="http://node-js.ru/">RailwayJS author's blog</a></li>
</ul>

</div>

<div class="span-one-third">

<h3>1. Install</h3>

<pre class="prettyprint">sudo npm install railway -g
</pre>

<h3>2. Use</h3>

<p>You can use app generator and the scaffold generator to build your first railway app in seconds</p>

<pre class="prettyprint">rw i blog &amp;&amp; cd blog
npm install -l
rw g crud post title content
# ensure mongodb is running
rw s 8888
open http://127.0.0.1:8888/posts
</pre>

</div>

<div class="span-one-third">

<h3>What is under the hood</h3>

<ul>
<li>Full MVC+H stack</li>
<li>Resource-based <a href="http://railwayjs.com/#routing">routing</a></li>
<li><a href="http://mongoosejs.com/">Mongoose.js</a> ORM</li>
<li>Multi-locale support</li>
<li><a href="http://jashkenas.github.com/coffee-script/">Coffee-script</a> support (<a href="http://railwayjs.com/#coffee">howto</a>)</li>
<li>Generators for model, controller, scaffold</li>
<li>Testing: nodeunit, cucumis, code coverage reporting</li>
<li>Debugging: <a href="http://railwayjs.com/#console">railway console</a></li>
<li><a href="http://railwayjs.com/#extensions">Extensions</a></li>
</ul>

</div>

</div></section>

<section id="routing"><div class="page-header">

<h1>Routing</h1>

</div>

<div class="row">

<div class="span4">

<p>The purpose of routes is to connect URL with controller action. For example you can define the following route in <code>config/routes.js</code> file:</p>

<pre class="prettyprint">map.get('signup', 'users#new');
</pre>

<p>to link <code>GET /signup</code> with <code>new</code> action of <code>users</code> controller.</p></p>

<pre class="prettyprint">map.root('home#index');
</pre>

<p>Will link GET / to <code>index</code> action of <code>home</code> controller</p>

</div>

<div class="span12">

<h3>Resource-based routing</h3>

<p>Resource-based routing provides standart mapping between HTTP verbs and controller actions:</p>

<pre class="prettyprint">map.resources('posts');
</pre>

<p>will provide following routes:</p>

<pre class="prettyprint">   helper | method | path                   | controller#action
---------------------------------------------------------------
     posts GET      /posts                   posts#index
     posts POST     /posts                   posts#create
  new_post GET      /posts/new               posts#new
 edit_post GET      /posts/:id/edit          posts#edit
      post DELETE   /posts/:id               posts#destroy
      post PUT      /posts/:id               posts#update
      post GET      /posts/:id               posts#show
</pre>

<p>to list available routes you can run command <code>railway routes</code>.</p>

<p>First column in table is <code>helper</code> - you can use this identifier in views and controllers to get route. Some examples:</p>

<pre class="prettyprint">path_to.new_post            # /posts/new
path_to.edit_post(1)        # /posts/1/edit
path_to.edit_post(post)     # /posts/1/edit (in this example post = {id: 1})
path_to.posts               # /posts
path_to.post(post)          # /posts/1
</pre>

</div>

</div>

<h2>Aliases for resourceful routes</h2>

<div class="row">

<div class="span4">

<p>If you want to override default routes behaviour, you can use two options:
<code>as</code> and <code>path</code> to specify helper name and path you want to have in the result.</p>

</div>

<div class="span12">

<h3>{ as: 'helperName' }</h3>

<p>Path helper aliasing:</p>

<pre class="prettyprint">map.resources('posts', {as: 'articles'});
</pre>

<p>will produce</p>

<pre class="prettyprint">     articles GET    /posts.:format?          posts#index
     articles POST   /posts.:format?          posts#create
  new_article GET    /posts/new.:format?      posts#new
 edit_article GET    /posts/:id/edit.:format? posts#edit
      article DELETE /posts/:id.:format?      posts#destroy
      article PUT    /posts/:id.:format?      posts#update
      article GET    /posts/:id.:format?      posts#show
</pre>

<h3>{ path: 'alternatePath' }</h3>

<p>If you want to change base path:</p>

<pre class="prettyprint">map.resources('posts', {path: 'articles'});
</pre>

<p>this will create following routes:</p>

<pre class="prettyprint">     posts GET    /articles.:format?          posts#index
     posts POST   /articles.:format?          posts#create
  new_post GET    /articles/new.:format?      posts#new
 edit_post GET    /articles/:id/edit.:format? posts#edit
      post DELETE /articles/:id.:format?      posts#destroy
      post PUT    /articles/:id.:format?      posts#update
      post GET    /articles/:id.:format?      posts#show
</pre>

<h3>all together</h3>

<p>And if you want alias both helper and path, use both:</p>

<pre class="prettyprint">map.resources('posts', {path: 'articles', as: 'stories'});
</pre>

<p>and you will get:</p>

<pre class="prettyprint">    stories GET    /articles.:format?          posts#index
    stories POST   /articles.:format?          posts#create
  new_story GET    /articles/new.:format?      posts#new
 edit_story GET    /articles/:id/edit.:format? posts#edit
      story DELETE /articles/:id.:format?      posts#destroy
      story PUT    /articles/:id.:format?      posts#update
      story GET    /articles/:id.:format?      posts#show
</pre>

</div>

</div>

<h2>Nested resources</h2>

<div class="row">

<div class="span4">

<p>Some resources may have nested sub-resources, for example <code>Post</code> has many <code>Comments</code>, and of course we want to get comments of the post using <code>GET /post/1/comments</code></p>

</div>

<div class="span12">

<p>Let's describe route for nested resource</p>

<pre class="prettyprint">map.resources('post', function (post) {
    post.resources('comments');
});
</pre>

<p>This routing map will provide the following routes:</p>

<pre class="prettyprint">$ rw r
     post_comments GET      /posts/:post_id/comments          comments#index
     post_comments POST     /posts/:post_id/comments          comments#create
  new_post_comment GET      /posts/:post_id/comments/new      comments#new
 edit_post_comment GET      /posts/:post_id/comments/:id/edit comments#edit
      post_comment DELETE   /posts/:post_id/comments/:id      comments#destroy
      post_comment PUT      /posts/:post_id/comments/:id      comments#update
      post_comment GET      /posts/:post_id/comments/:id      comments#show
             posts GET      /posts                            posts#index
             posts POST     /posts                            posts#create
          new_post GET      /posts/new                        posts#new
         edit_post GET      /posts/:id/edit                   posts#edit
              post DELETE   /posts/:id                        posts#destroy
              post PUT      /posts/:id                        posts#update
              post GET      /posts/:id                        posts#show
</pre>

<h3>Using url helpers for nested routes</h3>

<p>To use routes like <code>post_comments</code> you should call helper with param: parent resource or identifier before nested resource:</p>

<pre class="prettyprint">path_to.post_comments(post)               # /posts/1/comments
path_to.edit_post_comment(post, comment)  # /posts/1/comments/10/edit
path_to.edit_post_comment(2, 300)         # /posts/2/comments/300/edit
</pre>

</div>

</div>

<h2>Namespaces</h2>

<div class="row">

<div class="span4">

<p>You may wish to organize groups of controllers under a namespace. The most common use-case is Admin area. All controllers within <code>admin</code> namespace should be located inside <code>app/controllers/</code> dir.</p>

</div>

<div class="span12">

<p>For example, let's create admin namespace:</p>

<pre class="prettyprint">namespace('admin', function (admin) {
    admin.resources('users');
});
</pre>

<p>This routing rule will match with urls <code>/admin/users</code>, <code>admin/users/new</code>, and create appropriated url helpers</p>

<pre class="prettyprint">      admin_users GET    /admin/users.:format?          admin/users#index
      admin_users POST   /admin/users.:format?          admin/users#create
   new_admin_user GET    /admin/users/new.:format?      admin/users#new
  edit_admin_user GET    /admin/users/:id/edit.:format? admin/users#edit
       admin_user DELETE /admin/users/:id.:format?      admin/users#destroy
       admin_user PUT    /admin/users/:id.:format?      admin/users#update
       admin_user GET    /admin/users/:id.:format?      admin/users#show
</pre>

</div>

</div>

<div class="row">

<div class="span8">

<h2>Restricting routes</h2>

<p>If you need routes only for several actions (e.g. <code>index</code>, <code>show</code>) you can specify <code>only</code> option:</p>

<pre class="prettyprint">map.resources('users', {only: ['index', 'show']});
</pre>

<p>If you want to have all routes except some route, you can specify <code>except</code> option:</p>

<pre class="prettyprint">map.resources('users', {except: ['create', 'destroy']});
</pre>

</div>

<div class="span8">

<h2>Custom actions in resourceful routes</h2>

<p>If you need some specific action to be added to you resource-based route, use this example:</p>

<pre class="prettyprint">map.resources('users', function (user) {
    user.get('avatar', 'users#avatar');
});
</pre>

</div>

</div></section>

<section id="controller"><div class="page-header">

<h1>Controller <small>middle-layer between models and views</small></h1>

</div>

<div class="row">

<div class="span4">

<h2>Synopsis</h2>

<p>Controllers in railway - is a module, that receives user input and initiates response. Controller consists of a set of actions. Each action is called by the request of particular route. To define action you should use reserved global function <code>action</code>:</p>

<pre class="prettyprint">action('index', function () {
    render();
});
</pre>

</div>

<div class="span12">

<h2>Features overview</h2>

<p>Inside controller you can use following reserved global functions to control response:</p>

<ul>
<li><strong>render</strong> - render view template related to this action</li>
<li><strong>send</strong> - send to client text, status code or json object</li>
<li><strong>redirect</strong> - redirect client to specific location</li>
<li><strong>header</strong> - send header to client</li>
<li><strong>flash</strong> - display flash message</li>
</ul>

<p>And here is a bunch of functions to control execution flow:</p>

<ul>
<li><strong>before</strong> - invoke this method before any action</li>
<li><strong>after</strong> - invoke this method after any action</li>
<li><strong>load</strong> - load another controller to use it methods</li>
<li><strong>use</strong> or <strong>export</strong> - get method defined in another controller, loaded with <code>load</code> function</li>
<li><strong>publish</strong> or <strong>import</strong> - allow method to be used in other controller</li>
</ul>

<p>Let's learn more about each of this functions.</p>

</div>

</div>

<div class="row">

<h2>Response control</h2>

<div class="span4">

<p><strong>NOTE: each action should invoke one output method. This is the only requirement imposed by the asynchronous nature Node.JS. If output method wouldn't called, client will wait for server responce indefinitely.</strong></p>

</div>

<div class="span12">

<h3>render</h3>

<p><code>render</code> method accepts 0, 1, or 2 arguments. Called without agruments it just render view associated with this action. For example:</p>

<p><code>posts_controller.js</code></p>

<pre class="prettyprint">action('index', function () {
    render();
});
</pre>

<p>will render view app/views/posts/index.ejs.</p>

<p>If you want to pass some data to the view, there are two ways to do it. First:</p>

<pre class="prettyprint">action('index', function () {
    render({title: "Posts index"});
});
</pre>

<p>and second:</p>

<pre class="prettyprint">action('index', function () {
    this.title = "Posts index";
    render();
});
</pre>

<p>And if you want to render another view, just put it's name as first argument:</p>

<pre class="prettyprint">action('update', function () {
    this.title = "Update post";
    render('edit');
});
</pre>

<p>or</p>

<pre class="prettyprint">action('update', function () {
    render('edit', {title: "Update post"});
});
</pre>

<h3>send</h3>

<p>Send function useful for debugging and one-page apps, where you don't want to render heavy template and just want to send text or JSON data.</p>

<p>This function can be called with number (status code):</p>

<pre class="prettyprint">action('destroy', function () {
    send(403); // client will receive statusCode = 403 Forbidden
});
</pre>

<p>or with string:</p>

<pre class="prettyprint">action('sayHello', function () {
    send('Hello!'); // client will receive 'Hello!'
});
</pre>

<p>or with object:</p>

<pre class="prettyprint">action('apiCall', function () {
    send({hello: 'world'}); // client will receive '{"hello":"world"}'
});
</pre>

<h3>redirect</h3>

<p>This function just set status code and location header, so client will be redirected to another location.</p>

<pre class="prettyprint">redirect('/'); // root redirection
redirect('http://example.com'); // redirect to another host
</pre>

<h3>flash</h3>

<p>Flash function stores message in session for future displaying, this is regular expressjs function, refer to <a href="http://expressjs.com/guide.html#req.flash()">expressjs guide</a> to learn how it works. Few examples:</p>

<p><code>posts_controller.js</code></p>

<pre class="prettyprint">action('create', function () {
    Post.create(req.body, function (err) {
        if (err) {
            flash('error', 'Error while post creation');
            render('new', {post: req.body});
        } else {
            flash('info', 'Post has been successfully created');
            redirect(path_to.posts);
        }
    });
});
</pre>

<p>This <code>create</code> action sends flash info on success and flash error on fail.</p>

</div>

</div>

<h2>Execution flow control</h2>

<div class="row">

<div class="span4">

<p>To provide ability of DRY-ing controller code, and reusing common code parts Railway provides few additional tools: method chaining and external controllers loading.</p>

</div>

<div class="span12">

<p>To chain methods you can use <code>before</code> and <code>after</code> methods:</p>

<p><code>checkout_controller.js</code></p>

<pre class="prettyprint">before(userRequired, {only: 'order'});
before(prepareBasket, {except: 'order'});
before(loadProducts, {only: ['products', 'featuredProducts']});

action('products', function () {...});
action('featuredProducts', function () {...});
action('order', function () {...});
action('basket', function () {...});

function userRequired () {next()}
function prepareBasket () {next()}
function loadProducts () {next()}
</pre>

<p>In this example function <code>userRequired</code> will called only for <code>order</code> action, <code>prepareBasket</code> function will called for all actions except <code>order</code>, and <code>loadProducts</code> function will called only for actions <code>products</code> and <code>featuredProducts</code>.</p>

<p>Note, that the before-functions should call global method <code>next</code> that will pass controll to the next function in chain.</p>

</div>

</div>

<h2>Common execution context</h2>

<div class="row">

<div class="span4">

<p>There is one implicit feature in chaining: all functions in chain invoked in one context, so you can pass data between chain using <code>this</code> object:</p>

</div>

<div class="span12">

<pre class="prettyprint">function loadProducts () {
    Product.find(function (err, prds) {
        this.products = prds;
        next();
    }.bind(this));
}

action('products', function () {
    assert.ok(this.products, 'Products available here');
    render(); // also products will available in view
});
</pre>

</div>

</div>

<h2>Sharing code between controllers</h2>

<div class="row">

<div class="span4">

<p>Some methods, like <code>userRequired</code> for example, can be used in different controllers, to allow cross-controller code sharing railway provides few methods: <code>load</code>, <code>use</code> and <code>publish</code>.</p>

</div>

<div class="span12">

<p>You can define <code>requireUser</code> in <code>application_controller.js</code> and call <code>publish</code>, and then you will be able to <code>use</code> it in your controller:</p>

<p><code>application_controller.js</code></p>

<pre class="prettyprint">publish('requireUser', requireUser);
function requireUser () {
}
</pre>

<p>then load application controller and use requireUser function here:</p>

<p><code>products_controller.js</code></p>

<pre class="prettyprint">load('application'); // note that _controller siffix omitted
before(use('userRequired'), {only: 'products'});
</pre>

</div>

</div>

<h2>Other express.js features</h2>

<div class="row">

<div class="span4">

<p>To get familiar with railway controllers look to few examples available at github: <a href="https://github.com/anatoliychakkaev/railwayjs.com/blob/master/app/controllers/pages_controller.coffee">coffee controller</a>, <a href="https://github.com/1602/router/blob/master/app/controllers/users_controller.js">javascript controller</a></p>

</div>

<div class="span12">

<p>All other expressjs features have no global shortcuts yet, but they still can be used, because object <code>request</code> (or, shorter <code>req</code>) and <code>response</code> (alias <code>res</code>), are available as global variables in controller context. In view context only available long aliases: <code>response</code> and <code>request</code> to provide better coding style (it is bad to use this variables in views, but it's possible).</p>

</div>

</div></section>

<section id="views"><div class="page-header">

<h1>Views <small>layouts, partials, views, helpers, forms, csrf-stuff, etc..</small></h1>

</div>

<div class="row">

<div class="span-one-third">

<h3>Templating engines</h3>

<p>By default railway use <code>ejs</code> templating engine, but you can switch to jade, using settings</p>

<pre class="prettyprint">app.set('view engine', 'jade');
</pre>

<p>and add line</p>

<pre class="prettyprint">require('jade-ext');
</pre>

<p>to <code>./npmfile.js</code></p>

</div>

<div class="span-two-thirds">

<h3>View rendering flow</h3>

<p>Every controller action may call <code>render</code> method to display associated view. For example, action <code>index</code> in controller <code>users</code> will render view in file <code>app/views/users/index.ejs</code>.</p>

<p>This view will be rendered within the layout specified by <code>layout</code> call in the controller. By default layout name is the same as controller name, <code>app/views/layouts/users_layout.ejs</code> in this case. If this layout file is not exists, <code>application</code> layout used.</p>

<p>If you need render view without layout you can call <code>layout(false)</code> inside controller, this will skip layout rendering.</p>

</div>

</div>

<h3>Built-in Helpers</h3>

<div class="row">

<div class="span4">

<ul>
<li><code>link_to</code></li>
</ul>

</div>

<div class="span12">

<pre class="prettyprint">link_to('Users index', '/users');
// &lt;a href="/users"&gt;Users index&lt;/a&gt;
link_to('Users index', '/users', {class: 'menu-item'});
// &lt;a href="/users" class="menu-item"&gt;Users index&lt;/a&gt;
link_to('Users index', '/users', {remote: true});
// &lt;a href="/users" data-remote="true"&gt;Users index&lt;/a&gt;
</pre>

<ul>
<li>First argument is link text.</li>
<li>Second argument is link path.</li>
<li>Third argument is object with link properties.</li>
</ul>

<p>In the last example third argument is <code>{remote: true}</code>, and as you can see it will add <code>data-remote="true"</code> attribute to <code>a</code> tag. Clicking on this link will send async GET request to <code>/users</code>. Result will be executed as javascript.</p>

<p>Here you can also specify <code>jsonp</code> param to handle response:</p>

<pre class="prettyprint">link_to('Users index', '/users', {remote: true, jsonp: 'renderUsers'});
// &lt;a href="/users" data-remote="true" data-jsonp="renderUsers"&gt;Users index&lt;/a&gt;
</pre>

<p>Server will send you json <code>{users: [{},{},{}]}</code>, and this object will be passed as an argument to the <code>renderUsers</code> function:</p>

<pre class="prettyprint">renderUsers({users: [{},{},{}]});
</pre>

<p>You can also specify anonimous function in jsonp param:</p>

<pre class="prettyprint">{jsonp: '(function (url) {location.href = url;})'}
</pre>

<p>When server will send you <code>"http://google.com/"</code> following javascript will be evaluated:</p>

<pre class="prettyprint">(function (url) {location.href = url;})("http://google.com");
</pre>

<p>This is why you should wrap anonimous function with parentheses.</p>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>form_for</code></li>
</ul>

</div>

<div class="span12">

<p>Accepts three params: resource, params and block. Block is function that receives as single param special object, which provide helpers with pre-filled values. Available helpers:</p>

<ul>
<li>input</li>
<li>label</li>
<li>textarea</li>
<li>submit</li>
<li><p>checkbox</p>

<% form_for(user, {action: path_to.users}, function (form) { %>

   <p>
       <%- form.label('name', 'Username') %>
       <%- form.input('name') %>
   </p>
   <p>
       <%- form.submit('Save') %>
   </p>
<% }); %></li>
</ul>

<p>will generate</p>

<pre class="prettyprint">&lt;form action="/users/1" method="POST"&gt;
    &lt;input type="hidden" name="_method" value="PUT" /&gt;
    &lt;input type="hidden" name="authencity_token" value="qwertyuiop1234567890!@#$%^&amp;*()" /&gt;
   &lt;p&gt;
       &lt;label for="name"&gt;Username&lt;/label&gt;
       &lt;input id="name" name="name" value="Anatoliy" /&gt;
   &lt;/p&gt;
   &lt;p&gt;
       &lt;input type="submit" value="Save" /&gt;
   &lt;/p&gt;        
&lt;/form&gt;
</pre>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>form_tag</code></li>
</ul>

</div>

<div class="span12">

<p>This is "light" version of <code>form_for</code> helper. It accepts just two arguments: params and block. Block didn't receives any params.
Use this helper when you have no any resource, but still want to be able to use simple method overriding and csrf protection tokens.
<em>TODO: add code sample</em></p>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>input_tag</code> and <code>form.input</code></li>
</ul>

</div>

<div class="span12">

<p>TODO: describe <code>input_tag</code></p>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>label_tag</code> and <code>form.label</code></li>
</ul>

</div>

<div class="span12">

<p>TODO: describe <code>label_tag</code></p>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>stylesheet_link_tag</code></li>
</ul>

</div>

<div class="span12">

<pre class="prettyprint">&lt;%- stylesheet_link_tag('reset', 'style', 'mobile') %&gt;
</pre>

<p>will generate</p>

<pre class="prettyprint">&lt;link media="screen" rel="stylesheet" type="text/css" href="/stylesheets/reset.css?1306993455523" /&gt; 
&lt;link media="screen" rel="stylesheet" type="text/css" href="/stylesheets/style.css?1306993455523" /&gt;
</pre>

<p>Timestamps <code>?1306993455523</code> added to assets only in development mode in order to prevent browser from caching scripts and style in client-side</p>

</div>

</div>

<div class="row">

<div class="span4">

<ul>
<li><code>javascript_include_tag</code></li>
</ul>

</div>

<div class="span12">

<pre class="prettyprint">&lt;%- javascript_include_tag(
  'https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js',
  'rails', 'application') %&gt;
</pre>

<p>will generate</p>

<pre class="prettyprint">&lt;script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" src="/javascripts/rails.js?1306993455524"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" src="/javascripts/application.js?1306993455524"&gt;&lt;/script&gt; 
</pre>

<p>Timestamps <code>?1306993455524</code> added to assets only in development mode in order to prevent browser from caching scripts and style in client-side</p>

<p>By default railway expect assets to be located in <code>public/javascripts</code> and <code>public/stylesheets</code> directories, but this settings can be overwritten in <code>config/environment.js</code> file:</p>

<pre class="prettyprint">app.set('jsDirectory', '/js/');
app.set('cssDirectory', '/css/');
</pre>

</div>

</div></section>

<section id="generators"><div class="page-header">

<h1>Generators <small>Create app from scratch using generators</small></h1>

</div>

<div class="row">

<div class="span4">

Railway generators - are automated tools allows you to create bunch of files automatically.
</div>

<div class="span8">

<p>Each generator can be invoked by command</p>

<pre class="prettyprint">rw generate GENERATOR_NAME
</pre>

<p>or, using shortcut</p>

<pre class="prettyprint">rw g GENERATOR_NAME
</pre>

Built-in generators: model, controller, scaffold (crud)
</div>

</div>

<h2>Generate controller</h2>

<div class="row">

<div class="span4">

<p>Usecase: you do not need standart RESTful controller, just few non-standart actions</p>

</div>

<div class="span8">

<p>Example call:</p>

<pre class="prettyprint">rw g controller controllername actionName anotherActionName
</pre>

<p>Generate files:</p>

<pre class="prettyprint">exists  app/
exists  app/controllers/
create  app/controllers/controllername_controller.js
exists  app/helpers/
create  app/helpers/controllername_helper.js
exists  app/views/
create  app/views/controllername/
create  app/views/controllername/actionName.ejs
create  app/views/controllername/anotherActionName.ejs
</pre>

<p>Generated contents of controller file:</p>

<pre class="prettyprint">load('application');

action("actionName", function () {
    render();
});

action("anotherActionName", function () {
    render();
});
</pre>

</div>

</div>

<h2>Generate model</h2>

<div class="row">

<div class="span4">

<p>Usecase: you want to access some database entity using ORM interface (mongoose by default)</p>

</div>

<div class="span8">

<p>Example call:</p>

<pre class="prettyprint">railway g model user name password
</pre>

<p>Will generate</p>

<pre class="prettyprint">exists  app/
exists  app/models/
create  app/models/user.js
</pre>

<p>Following mongoose schema will be created:</p>

<pre class="prettyprint">/**
 * User
 */
var UserSchema = new Schema;
UserSchema.add({
    name: { type: String },
    password: { type: String }
});
mongoose.model("User", UserSchema);
module.exports["User"] = mongoose.model("User");
</pre>

<p>If you need to specify field types (<code>String</code> by default):</p>

<pre class="prettyprint">railway g model user name password createdAt:date activated:boolean
</pre>

</div>

</div>

<h2>Generate scaffold (crud)</h2>

<div class="row">

<div class="span4">

<p>The most commonly used generator. It creates ready-to-use resource controller with all actions, views, schema definitions, routes, and <strong>tests</strong>. RW also can generated scaffold in <strong>CoffeeScript</strong>.</p>

</div>

<div class="span8">

<p>Example call:</p>

<pre class="prettyprint">rw g scaffold post title content createdAt:date
exists  app/
exists  app/models/
create  app/models/post.js
exists  app/
exists  app/controllers/
create  app/controllers/posts_controller.js
exists  app/helpers/
create  app/helpers/posts_helper.js
create  app/views/layouts/posts_layout.ejs
create  public/stylesheets/scaffold.css
exists  app/views/
create  app/views/posts/
create  app/views/posts/_form.ejs
create  app/views/posts/new.ejs
create  app/views/posts/edit.ejs
create  app/views/posts/index.ejs
create  app/views/posts/show.ejs
patch   config/routes.js
</pre>

<p>Using scaffold generator - fastest way to create prototype of application.</p>

</div>

</div></section>

<section id="console"><div class="page-heading">

<h1>REPL console <small>Learn, debug, investigate</small></h1>

</div>

<div class="row">

<div class="span4">

<p>To run REPL console use command</p>

<pre class="prettyprint">rw console
</pre>

<p>or it's shortcut</p>

<pre class="prettyprint">rw c
</pre>

</div>

<div class="span8">

<p>It just simple node-js console with some Railway bindings, e.g. models. Just one note
about working with console. Node.js is asynchronous by its nature, and it's great
but it made console debugging much more complicated, because you should use callback
to fetch result from database, for example. I have added one useful method to
simplify async debugging using railway console. It's name <code>c</code>, you can pass it
as parameter to any function requires callback, and it will store parameters passed
to callback to variables <code>_0, _1, ..., _N</code> where N is index in <code>arguments</code>.</p>

<p>Example:</p>

<pre class="prettyprint">railway c
railway&gt; User.find(53, c)
Callback called with 2 arguments:
_0 = null
_1 = [object Object]
railway&gt; _1
{ email: [Getter/Setter],
  password: [Getter/Setter],
  activationCode: [Getter/Setter],
  activated: [Getter/Setter],
  forcePassChange: [Getter/Setter],
  isAdmin: [Getter/Setter],
  id: [Getter/Setter] }
</pre>

</div>

</div></section>

<section id="coffee"><div class="page-heading">

<h1>Write your app in CoffeeScript <small>Drink coffee &mdash; do stupid things faster with more energy</small></h1>

</div>

<div class="row">

<div class="span4">

<p>Almost all parts of app can be written in CoffeeScript. If you like coding in Coffee, please do. Just put <code>--coffee</code> option to <code>rw</code> commands.</p>

</div>

<div class="span8">

<pre class="prettyprint">rw init blog --coffee
npm install -l
cd blog
rw g scaffold post title content --coffee
</pre>

<p>And then you can run <code>railway server</code> or <code>coffee server.coffee</code> to have server running on 3000 port</p>

<p>For example, here is generated coffee-controller:</p>

<pre class="prettyprint">before -&gt;
    Post.findById req.params.id, (err, post) =&gt;
        if err or not post
            redirect path_to.posts
        else
            @post = post
            next()
, only: ['show', 'edit', 'update', 'destroy']

# GET /posts/new
action 'new', -&gt;
    @post = new Post
    render
        title: 'New post'

# POST /posts
action 'create', -&gt;
    @post = new Post
    ['title', 'content'].forEach (field) =&gt;
        @post[field] = req.body[field] if req.body[field]?

    @post.save (errors) -&gt;
        if errors
            flash 'error', 'Post can not be created'
            render 'new',
                title: 'New post'
        else
            flash 'info', 'Post created'
            redirect path_to.posts

# GET /posts
action 'index', -&gt;
    Post.find (err, posts) -&gt;
        render
            posts: posts
            title: 'Posts index'

# GET /posts/:id
action 'show', -&gt;
    render
        title: 'Post show'

# GET /posts/:id/edit
action 'edit', -&gt;
    render
        title: 'Post edit'

# PUT /posts/:id
action 'update', -&gt;
    ['title', 'content'].forEach (field) =&gt;
        @post[field] = req.body[field] if req.body[field]?

    @post.save (err) =&gt;
        if not err
            flash 'info', 'Post updated'
            redirect path_to.post(@post)
        else
            flash 'error', 'Post can not be updated'
            render 'edit',
                title: 'Edit post details'

# DELETE /posts/:id
action 'destroy', -&gt;
    @post.remove (error) -&gt;
        if error
            flash 'error', 'Can not destroy post'
        else
            flash 'info', 'Post successfully removed'
        send "'" + path_to.posts + "'"
</pre>

</div>

</div></section>

<section id="localization"><div class="page-header">

<h1>Localization <small>How to build multi-language apps</small></h1>

</div>

<div class="row">

<div class="span4">

<p>Basic steps:</p>

<ol>
<li>create dictionary to translate tokens to natural language (<code>config/locales/*.yml</code>)</li>
<li>Use tokens instead of natural language everywhere in app (<code>t</code> helper)</li>
<li>Manually detect language of each user request (<code>setLocale</code> method)</li>
</ol>

</div>

<div class="span8">

<p>Railway allows you to create application translated to different languages: just place localization file in <code>yaml</code> format to <code>config/locales</code> dir:</p>

<p><code>config/locales/en.yml</code></p>

<pre class="prettyprint">en:
  session:
    new: "Sign in"
    destroy: "Sign out"
  user:
    new: "Sign up"
    destroy: "Cancel my account"
    welcome: "Hello %, howdy?
    validation:
      name: "Username required"
</pre>

<p>NOTE: translations can contain <code>%</code> symbol(s), that means variable substitution</p>

<p>Define user locale in application controller:</p>

<p><code>app/controllers/application_controller.js</code></p>

<pre class="prettyprint">before(setUserLocale);
function setUserLocale () {
    // define locale from user settings, or from headers or use default
    var locale = req.user ? req.user.locale : 'en';
    // call global function setLocale
    setLocale(locale);
}
</pre>

<p>and use localized tokens inside app views with <code>t</code> helper:</p>

<pre class="prettyprint">&lt;%= t('session.new') %&gt;
&lt;%= t('user.new') %&gt;
&lt;%= t(['user.welcome', user.name]) %&gt;
</pre>

<p>or inside controllers:</p>

<pre class="prettyprint">flash('error', t('user.validation.name'));
</pre>

<p>or inside models:</p>

<pre class="prettyprint">return t('email.activate', 'en');
</pre>

<p>NOTE: when use t helpers inside models you must pass <code>locale</code> as second param to <code>t</code> helper.</p>

<h2>Configuration</h2>

<p>Localization behavior can be configured using following settings:</p>

<ul>
<li>defaultLocale: name of default locale</li>
<li>translationMissing: what action perfor when translation is missing, possible values: <code>default</code> - display translation for default locale, <code>display</code> - show error like "Translation missing for email.activate"</li>
</ul>

<p>Example:</p>

<pre class="prettyprint">app.configure(function () {
    app.set('defaultLocale', 'en');
});

app.configure('development', function(){
    app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));
    app.set('translationMissing', 'display');
});

app.configure('production', function () {
    app.use(express.errorHandler()); 
    app.set('translationMissing', 'default');
});
</pre>

</div>

</div></section>

<section id="extensions"><div class="page-header">

<h1>Extensions API <small>Simple way to add missing functionality to the framework</small></h1>

</div>

<div class="row">

<div class="span4">

<p>Any npm package is already extension for railway. Just put line to <code>npmfile.js</code>, for example:</p>

<pre class="prettyprint">require('railway-twitter');
</pre>

<p>Just one note: if package have <code>init</code> method, it will be invoked after application initialization.</p>

<p>For example you can check out <a href="https://github.com/1602/railway-twitter">twitter-auth extension</a> for railway.</p>

</div>

<div class="span8">

<h2>Installation script</h2>

<p>If your extension have <code>install.js</code> script in the root, it will be invoked after installation with <code>railway install</code> command.</p>

<p>This script will be executed in application context, i.e. you can access global variables <code>app</code> and <code>railway</code>. You <strong>must</strong> call <code>process.exit()</code> when installation process has been completed.</p>

<h2>Railway extension API</h2>

<p>All railway modules published as global singleton <code>railway</code>. Any module can be extended or monkey-patched. Let's take a look to most common use-cases.</p>

<h2>Tools</h2>

<p>Hash <code>railway.tools</code> contains commands that can be invoked using command line, for example <code>railway routes</code> command will call <code>railway.tools.routes()</code> method.</p>

<p>To write tool, just add method to <code>railway.tools</code> object, name of this method will become the command:</p>

<pre class="prettyprint">railway.tools.database = function () {
    switch (railway.args.shift()) {
    case 'clean':
        // clean db
        break;
    case 'backup':
        // backup db
        break;
    case 'restore':
        // restore db
        break;
    default:
        console.log('Usage: railway database [clean|backup|restore]');
    }
};
</pre>

<p>then the following commands will be available for call:</p>

<pre class="prettyprint">railway database
railway database backup
railway database clean
railway database restore
</pre>

<p>If you want to see this command in help message <code>railway help</code> you can provide some information about tool using <code>help</code> hash:</p>

<pre class="prettyprint">railway.tools.db.help = {
    shortcut: 'db',
    usage: 'database [backup|restore|clean]',
    description: 'Some database features'
};
</pre>

<p>Next time you will call railway help you'll see:</p>

<pre class="prettyprint">Commands:
   ...
   db, database [backup|restore|clean]  Some database features
</pre>

<p>If you have defined shortcut, it can be used instead of full command name:</p>

<pre class="prettyprint"> railway db clean
</pre>

<p>To learn more, please check out <a href="https://github.com/1602/express-on-railway/blob/master/lib/tools.js">the sources: <code>lib/tools.js</code></a></p>

<h2>Generators</h2>

<p>Coming soon. It's about <code>railway.generators</code> module and <code>railway generate smth</code> family of commands.</p>

<h2>Discussion in google groups</h2>

<p>API is still in develop now, feel free to leave comments about it in the related google groups <a href="http://groups.google.com/group/railwayjs/browse_thread/thread/1cfa3e1e348fc62c">thread</a>.</p>

</div>

</div></section>

<section id="heroku"><div class="page-header">

<h1>Heroku <small>Guide for deploying RailwayJS app on <a href="http://heroku.com/">Heroku.com</a> cloud hosting</small></h1>

</div>

<div class="row">

<div class="span4">

<p>Heroku nodejs hosting is available for public using now. You can deploy your RailwayJS application as simple as <code>git push</code>.</p>

<p>To work with heroku you also need: ruby, <code>heroku</code> gem</p>

</div>

<div class="span8">

<p>First of all, create app</p>

<pre class="prettyprint">railway init heroku-app
cd heroku-app
sudo npm link
railway g crud post title content
</pre>

<p>Then init git repo</p>

<pre class="prettyprint">git init
git add .
git commit -m 'Init'
</pre>

<p>Create heroku app</p>

<pre class="prettyprint">heroku create --stack cedar
</pre>

<p>Want to use <strong>mongodb</strong>?</p>

<pre class="prettyprint">heroku addons:add mongohq:free
</pre>

<p>Want to use <strong>redis</strong>?</p>

<pre class="prettyprint">heroku addons:add redistogo:nano
</pre>

<p>And deploy</p>

<pre class="prettyprint">git push heroku master
</pre>

<p>Hook up Procfile (only once)</p>

<pre class="prettyprint">heroku ps:scale web=1
</pre>

<p>Check application state</p>

<pre class="prettyprint">heroku ps
</pre>

<p>Visit app</p>

<pre class="prettyprint">heroku open
</pre>

<p>If something went wrong, you can check out logs</p>

<pre class="prettyprint">heroku logs
</pre>

<p>But for me it useless. Better to run commands in node console:</p>

<pre class="prettyprint">heroku run node
&gt; var app = require('railway').createServer();
</pre>

<p>It helps to identify exact problems with app installation.
Also you can access railway console using command</p>

<pre class="prettyprint">heroku run railway console
</pre>

<p>BTW, mongohq provides web interface for browsing your mongo database, to use it go to http://mongohq.com/ and create account,
then click "Add remote connection" and configure link to database. You can retrieve details required for connection using command</p>

<pre class="prettyprint">heroku config --long
</pre>

</div>

</div></section>

<section id="snippets"><div class="page-header">

<h1>Code snippets <small>Useful pieces of code</small></h1>

</div>

<h2>Redis session store for Heroku deployment with redistogo addon</h2>

<div class="row">

<div class="span4">

<p>Hook <code>REDISTOGO_URL</code> environment variable in
<code>config/environment.js</code> and pass it to RedisStore constructor.</p>

</div>

<div class="span8">

<pre class="prettyprint">var express    = require('express'),
    RedisStore = require('connect-redis')(express);

var redisOpts;
if (process.env['REDISTOGO_URL']) {
    var url = require('url').parse(process.env['REDISTOGO_URL']);
    var redisOpts = {
        port: url.port,
        host: url.hostname,
        pass: url.auth.split(':')[1]
    };
} else {
    redisOpts = {};
}

app.configure(function(){
    var cwd = process.cwd();
    app.use(express.static(cwd + '/public', {maxAge: 86400000}));
    app.set('views', cwd + '/app/views');
    app.set('view engine', 'ejs');
    app.set('jsDirectory', '/javascripts/');
    app.set('cssDirectory', '/css/');
    app.use(express.bodyParser());
    app.use(express.cookieParser());
    app.use(express.session({secret: 'secret', store: new RedisStore(redisOpts)}));
    app.use(express.methodOverride());
    app.use(app.router);
});
</pre>

</div>

</div>

<h2>Upload file to railway server</h2>

<div class="row">

<div class="span4">

<ul>
<li><a href="http://groups.google.com/group/railwayjs/browse_thread/thread/592df72830898e9a">Discussion in google group</a></li>
<li>The solution is to use <a href="https://github.com/anatoliychakkaev/connect-form-sync">this middleware</a></li>
<li>Check out <a href="https://github.com/anatoliychakkaev/railway-example-upload">example app</a></li>
</ul>

</div>

<div class="span8">

<pre class="prettyprint">var form = require('connect-form-sync');
app.configure(function(){
    ....
    app.use(form({ keepExtensions: true }));
    app.use(express.bodyParser());
    ....
});
</pre>

<p>and use in controller like that:</p>

<pre class="prettyprint">action('create', function () {
    this.file = new File();
    var tmpFile = req.form.files.file;
    this.file.upload(tmpFile.name, tmpFile.path, function (err) {
        if (err) {
            console.log(err);
            this.title = 'New file';
            flash('error', 'File can not be created');
            render('new');
        } else {
            flash('info', 'File created');
            redirect(path_to.files);
        }
    }.bind(this));
});
</pre>

</div>

</div></section>
<script>$(function () {$.getScript("http://railwayjs.disqus.com/count.js");})</script>
</div>

<footer class="footer">
<div class="container">
  <p class="pull-right"><a href="#">Back to top</a></p>
  <p>
    Documentation written by <a href="http://twitter.com/1602">@1602 (Anatoliy Chakkaev)</a>.<br/>
    Designed and built with all the love in the world <a href="http://twitter.com/twitter" target="_blank">@twitter</a> by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>.<br>
    RailwayJS code licensed under the <a href="http://www.opensource.org/licenses/mit-license.php" target="_blank">MIT License</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
  </p>
</div>
</footer>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23280347-1']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

</script>

</html>
