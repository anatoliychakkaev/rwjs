<!DOCTYPE html>
<html>
  <head>
    <title>Try JugglingDB</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/playground.css">
    <link href="/javascripts/prettyprint/prettify.css" rel="stylesheet">

    <meta name="description" content="JugglingDB - cross-database ORM ActiveRecord-like" >
    <meta name="keywords" content="nodejs, activerecord, orm, mysql, redis, neo4j, javascript, async" >

    <script type="text/javascript" src="/schema.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/showdown.js"></script>
    <script type="text/javascript" src="/javascripts/playground.js"></script>
    <script type="text/javascript" src="/javascripts/prettyprint/prettify.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-dropdown.js"></script>

    <style>
    </style>

  </head>
  <body style="padding-top: 60px">
    <a href="http://github.com/1602/jugglingdb"><img style="position: fixed; top: 0; right: 0; border: 0;z-index: 10001;" src="https://d3nwyuy0nl342s.cloudfront.net/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>
    <div class="topbar-wrapper" style="z-index: 5;">
      <div class="topbar" data-scrollspy="scrollspy">
        <div class="topbar-inner">
          <div class="container">
            <h3><a href="#">JugglingDB</a></h3>
            <ul class="nav">
              <li class="dropdown" data-dropdown="dropdown">
                <a href="#" class="dropdown-toggle">Common</a>
                <ul class="dropdown-menu">
                  <li><a href="#create" rel="demo">create</a></li>
                  <li><a href="#find" rel="demo">find</a></li>
                  <li><a href="#all" rel="demo">all</a></li>
                  <li><a href="#updateAttribute" rel="demo">updateAttribute</a></li>
                  <li><a href="#updateAttributes" rel="demo">updateAttributes</a></li>
                  <li><a href="#count" rel="demo">count</a></li>
                  <li><a href="#destroy" rel="demo">destroy</a></li>
                  <li><a href="#destroyAll" rel="demo">destroyAll</a></li>
                  <li><a href="#hasMany" rel="demo">has many</a></li>
                  <li><a href="#belongsTo" rel="demo">belongsTo</a></li>
                </ul>
              </li>
              <li class="dropdown" data-dropdown="dropdown">
                <a href="#" class="dropdown-toggle">Validations</a>
                <ul class="dropdown-menu">
                  <li><a href="#validatesPresenceOf" rel="demo">presence</a></li>
                  <li><a href="#validatesLengthOf" rel="demo">length</a></li>
                  <li><a href="#validatesFormatOf" rel="demo">format</a></li>
                  <li><a href="#validatesNumericalityOf" rel="demo">numericality</a></li>
                  <li><a href="#validatesInclusionOf" rel="demo">inclusion</a></li>
                  <li><a href="#validatesExclusionOf" rel="demo">exclusion</a></li>
                  <li><a href="#validateCustom" rel="demo">custom</a></li>
                  <li><a href="#validateCustomAsync" rel="demo">custom async</a></li>
                  <li><a href="#validatesUniquenessOf" rel="demo">uniqueness</a></li>
                </ul>
              </li>
              <li class="dropdown" data-dropdown="dropdown">
                <a href="#" class="dropdown-toggle">Hooks</a>
                <ul class="dropdown-menu">
                  <li><a href="#hookInitialize" rel="demo">initialize</a></li>
                  <li><a href="#hookSave" rel="demo">save / create</a></li>
                  <li><a href="#hookUpdate" rel="demo">save / update</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div><!-- /topbar-inner -->
      </div><!-- /topbar -->
    </div><!-- /topbar-wrapper -->

<div class="container" id="container">
  <div class="page-header"><h1>Try JugglingDB</h1></div>

  <div class="row">

  <div class="span-one-half" id="doc" style="width: 450px;">
    Choose one of examples from the top bar's dropdowns (Common, Validations, Hooks, etc..), or just write your code after the <strong class="jugg">"jugglingdb>"</strong> prompt.

  <pre class="prettyprint">User = schema.define('User', {
    name:         String,
    bio:          Text,
    approved:     Boolean,
    joinedAt:     Date,
    age:          Number
});

Post = schema.define('Post', {
    title:     { type: String, length: 255 },
    content:   { type: Text },
    date:      { type: Date,    default: Date.now },
    published: { type: Boolean, default: false }
});</pre>

  </div>
  <div class="span-one-half" style="width: 450px;">

    <div class="example" id="example" style="overflow: auto; width: 450px;">
      <form><strong class="jugg">jugglingdb></strong>
        <input name="console" class="console" autocomplete="off">
      </form>
    </div>

  </div>
</div>

<footer class="footer">
<div class="container">
  <p class="pull-right"><a href="#">Back to top</a></p>
  <p>
    Documentation written by <a href="http://twitter.com/1602">@1602 (Anatoliy Chakkaev)</a>.<br/>
    Built on <a href="http://twitter.github.com/bootstrap">Bootstrap</a> from Twitter<br/>
    RailwayJS code licensed under the <a href="http://www.opensource.org/licenses/mit-license.php" target="_blank">MIT License</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
  </p>
  <h6 style="text-align: center" id="tip">
    RailwayJS and JugglingDB projects are free, but you can leave a tip here:
  </h6>
  <form style="text-align: center" action="https://www.paypal.com/cgi-bin/webscr" method="post">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="hosted_button_id" value="J3JJDYJW78LEJ">
    <input type="image" style="box-shadow: none; -webkit-box-shadow: none; padding: 0; border: 0; width: 147px; height: 47px;" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/ru_RU/i/scr/pixel.gif" width="1" height="1">
  </form>
</div>
</footer>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23280347-1']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

</script>

<script type="text/jugglingdb" name="init">
  User = schema.define('User', {
      name:         String,
      bio:          Text,
      email:        String,
      approved:     Boolean,
      joinedAt:     Date,
      age:          Number,
      gender:       String,
      domain:       String
  });

  Post = schema.define('Post', {
      title:     { type: String },
      content:   { type: String },
      date:      { type: Date,    default: Date.now },
      published: { type: Boolean, default: false }
  });
</script>

<script type="text/jugglingdb" name="blank">
</script>

<script type="text/jugglingdb" name="validatesPresenceOf">
  Post.validatesPresenceOf('title');
  var post = new Post();
  post.isValid();
  post.title = 'Title';
  post.isValid();
</script>

<script type="text/jugglingdb" name="validatesLengthOf">
  Post.validatesLengthOf('content', {max: 10, allowBlank: true});
  var post = new Post();
  post.isValid();
  post.content = 'hey';
  post.isValid();
</script>

<script type="text/jugglingdb" name="validatesFormatOf">
  var checkEmail = /^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i;
  User.validatesFormatOf('email', {with: checkEmail});
  user = new User;
  user.isValid();
  user.email = 'anatoliy@example.com';
  user.isValid();
</script>

<script type="text/jugglingdb" name="validatesInclusionOf">
  User.validatesInclusionOf('gender', {in: ['male', 'female']});
  var u = new User({gender: 'male'});
  u.isValid();
  u.gender = 'girl';
  u.isValid();
</script>

<script type="text/jugglingdb" name="validatesExclusionOf">
  User.validatesExclusionOf('domain', {in: ['www', 'admin']});
  var u = new User;
  u.isValid();
  u.domain = 'www';
  u.isValid();
</script>

<script type="text/jugglingdb" name="validateCustom">
  var customValidator = function (err) { if (this.name === 'bad') err(); };
  User.validate('name', customValidator, {message: 'Bad name'});
  var user = new User({name: 'Peter'});
  user.isValid();
  user.name = 'bad';
  user.isValid();
</script>

<script type="text/jugglingdb" name="validateCustomAsync">
  var customValidatorAsync = function (err, done) { if (this.name === 'bad') err; setTimeout(done, 1000);};
  user = new User;
  user.isValid(c);
  user.name = 'bad';
  user.isValid(c);
</script>

<script type="text/jugglingdb" name="validatesUniquenessOf">
  User.validatesUniquenessOf('email');
  User.create({email: 'email@example.com'}, c);
  var u = new User({email: 'email@example.com'});
  u.isValid(c);
  u.email = 'unique@email.com';
  u.isValid(c);
</script>

<script type="text/jugglingdb" name="validatesNumericalityOf">
  User.validatesNumericalityOf('age', {int: true});
  var u = new User({age: 26.5});
  u.isValid();
  u.age = 26;
  u.isValid();
</script>

<script type="text/jugglingdb" name="validatesNumericalityOf">
  User.validatesNumericalityOf('age', {int: true});
  var u = new User({age: 26.5});
  u.isValid();
  u.age = 26;
  u.isValid();
</script>

<script type="text/jugglingdb" name="hookInitialize">
  Post.afterInitialize = spy('init', function () { this.title = this.title || this.id; });
  new Post;
  // create 3 posts
  Post.create();
  Post.create();
  Post.create();
  // posts
  Post.all(c);
  _1[2].title;
</script>

<script type="text/markdown" name="hookCreate">
## BaseModel.{before|after}Create hook
This methods invoked on instance creation (when Model.create() method called)

## Arguments
- done - callback which should be invoked when hook done

## Behavior
**Note** that this hook is asyncronous, if `done` callback wouldn't be called
then create flow will be interrupted.

</script>
<script type="text/jugglingdb" name="hookCreate">
  Post.beforeCreate = spy('before create');
  Post.afterCreate = spy('after create');
  Post.create(c);
</script>

<script type="text/markdown" name="hookSave">
## BaseModel.{before|after}Save hook
This methods invoked on each save of instance (when instance.save() method called)

## Arguments
- done - callback which should be invoked when hook done

## Behavior
**Note** that this hook is asyncronous, if `done` callback wouldn't be called
then save flow will be interrupted.
</script>

<script type="text/jugglingdb" name="hookSave">
  Post.beforeCreate = spy('before create');
  Post.afterCreate = spy('after create');
  Post.beforeSave = spy('before save');
  Post.afterSave = spy('after save');
  Post.create(c);
  var s = new Post;
  s.save(c);
</script>

<script type="text/markdown" name="hookUpdate">
## BaseModel.{before|after}Update hook
This methods invoked on each update of instance

## Arguments
- done - callback which should be invoked when hook done

## Behavior
**Note** that this hook is asyncronous, if `done` callback wouldn't be called
then update flow will be interrupted.

This method called in context of instance, so, you can access instance's properties
using `this`. But only changes on updated fields will be saved to database:
when post.updateAttributes({'title': 'New title"}) called you can only
modify `this.title`, inside update hook, all other changes wouldn't stored to the database

Update hooks is the next in chain after the save hook.
</script>

<script type="text/jugglingdb" name="hookUpdate">
  Post.beforeUpdate = spy('before update');
  Post.beforeSave = spy('before save');
  Post.afterUpdate = spy('after update');
  Post.afterSave = spy('after save');
  Post.create(c);
  _1.title = 'Hello world';
  _1.save(c);
</script>

<script type="text/markdown" name="create">
## Model.create

Create new instance of Model class, saved in database

## Arguments (all optional)
- properties
- callback called with arguments:
  * err (null or Error)
  * instance (null or Model)

## Behavior
- inst = new Model(properties)
- inst.save(cb)
</script>

<script type="text/jugglingdb" name="create">
  User.create(c);
  User.create({email: 'haha@example.com'}, c);
  _0
  _1.email
</script>

<script type="text/markdown" name="find">
## Model.find

Find instance of Model by given id

## Arguments
- id (required)
- callback (required) called with arguments:
  * err (null or Error)
  * instance (null or Model)

## Behavior
- lookup database by unique index, load data
- if that record already instantiated, update all non-dirty attributes. Check example to get it.
</script>

<script type="text/jugglingdb" name="find">
  Post.create({title: 'hello', content: 'world'}, c);
  post = _1;
  post.content = 'jugglingdb'; // make attribute dirty
  post.propertyChanged('content');
  Post.find(post.id, c);
  post.content
  _1.content
  post.propertyChanged('content');
</script>

<script type="text/markdown" name="hasMany">
## BaseModel::hasMany

This class method defines has many relation

## Arguments
- target class (Post in example)
- options
  * as - name of scope (when 'posts' then User.prototype.posts created)
  * foreignKey - property name to store key in target model (Post.prototype.authorId)

## Behavior
- create named scope on this class
- ensure `target class` has property pointed by `foreignKey`
</script>

<script type="text/jugglingdb" name="hasMany">
  User.hasMany(Post, {as: 'posts', foreignKey: 'authorId'});
  User.create(c)
  var p = _1.posts.build();
  p.save();
  _1.posts(c);
</script>

</html>
