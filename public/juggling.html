<!DOCTYPE html>
<html>
  <head>
    <title>Try JugglingDB</title>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link href="/javascripts/prettyprint/prettify.css" rel="stylesheet">

    <meta name="description" content="JugglingDB - cross-database ORM ActiveRecord-like" >
    <meta name="keywords" content="nodejs, activerecord, orm, mysql, redis, neo4j, javascript, async" >

    <script type="text/javascript" src="/schema.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/prettyprint/prettify.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-dropdown.js"></script>

    <style>
      section {
        padding-top: 60px;
      }
      .example, .example form .console {
        font-family: monospace;
      }
      .example form .console {
        border: 0;
        box-shadow: none;
        -webkit-box-shadow: none;
        -moz-box-shadow: none;
        margin: 0;
        padding: 0;
        font-weight: 700;
      }
      strong.array {
        color: #479;
      }
      span.keyword {
        color: #479;
        font-weight: 700;
      }
      span.error {
        color: #944;
      }
      span.string {
        color: red;
      }
      div.log {
        font-weight: 700;
      }
      strong.jugg {
        color: lightgray;
      }
    </style>

    <script>
      if (!window.console) {
        window.console = {};
      }
      var undef;
      function stringify(v) {
        if (v === null) return '<span class="keyword">null</span>';
        if (typeof v === 'undefined') return '<span class="keyword">undefined</span>';
        if (v.constructor === Array) {
          return '<strong class="array">[</strong>' + v.join(', ') + '<strong class="array">]</strong>';
        }
        return v;
      }

      var c = function () {
        var args = '';
        [].forEach.call(arguments, function (arg, index) {
          var name = '_' + index;
          args += name + ' = ' + stringify(arg) + '<br/>';
          window[name] = arg;
        });
        console.result('Callback called with ' + arguments.length +
        ' arguments<br/>' +
        args, true);
      };

      AbstractClass.prototype.toString = function () {
        return '' + this.constructor.modelName + '#' + (this.id || 'new') + '';
      };
      console.log = function () {
        $('#example form').before('<div class="log"><strong class="jugg">jugglingdb></strong> <span class="code">' + [].join.call(arguments, ' ') + '</span></div>');
      };
      console.result = function (res, noformat) {
        var cls = '';
        if (!noformat) {
          if (res instanceof Error) {
            cls = 'error';
            res = res.message;
          } else if (typeof res === 'string') {
            cls = 'string';
            res = "'" + res + "'";
          } else if (typeof res == 'undefined') {
            return;
          }
          res = '<span class="' + cls + '">' + res + '</span>';
        }
        $('#example form').before('<div class="result"> ' + res + '</div>');
      };
      console.eval = function (s) {
        s = s.replace(/^\s+/, '');
        console.log(s);
        try {
          console.result(eval.call(null, s));
        } catch(e) {
          console.result(e);
        }
      };

      $(function () {
        $example = $('#example');

        $('a[rel="demo"]').click(function () {
          demonstrate($(this).attr('href').replace('#', ''));
        });

        var $input = $('#example form input');
        $input[0].focus();
        $input.keydown(function(event) {
          var count = $example.find(".log").size();
          var index = $input.data("index");
          if (index == undefined) index = count;

          if (event.keyCode == 38) {
          index--; // up
          } else if (event.keyCode == 40) {
          index++; // down
          } else {
          return;
          }

          // Out of range at the positive side of the range makes sure
          // we can get back to an empty value.
          if (index >= 0 && index <= count) {
            $input.data("index", index);
            $input.val($example.find(".log").eq(index).find('.code').text());
            $input.setSelection($input.val().length);
          }

          return false;
        });

        $('#example form').submit(function () {
          console.eval($input.val());
          $input.val('');
          $input[0].focus();
          $input.data("index", null);
          return false;
        });

        window.scripts = {};
        $('script[type="text/jugglingdb"]').each(function () {
          scripts[$(this).attr('name')] = $(this).text();
        });

        if (location.hash) {
          demonstrate(location.hash.replace('#', ''));
        }

        prettyPrint();

      });

      function demonstrate(name) {
        $('#example div').remove();
        if (scripts[name]) {
          runScript(scripts[name]);
        } else {
        }
      }

      function runScript(text) {
        eval.call(null, scripts.init);

        var cmds = [];
        text.split(/\n/).forEach(function (s) {
          if (s.replace(/^\s+|\s+$/g, '')) cmds.push(s);
        });
        run();

        function run() {
          var cmd = cmds.shift();
          if (cmd) {
            console.eval(cmd);
            setTimeout(run, 100);
          }
        };
      }
    </script>

  </head>
  <body style="padding-top: 60px">
    <a href="http://github.com/1602/jugglingdb"><img style="position: fixed; top: 0; right: 0; border: 0;z-index: 10001;" src="https://d3nwyuy0nl342s.cloudfront.net/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>
    <div class="topbar-wrapper" style="z-index: 5;">
      <div class="topbar" data-scrollspy="scrollspy">
        <div class="topbar-inner">
          <div class="container">
            <h3><a href="#">JugglingDB</a></h3>
            <ul class="nav">
              <li class="dropdown" data-dropdown="dropdown">
                <a href="#" class="dropdown-toggle">Validations</a>
                <ul class="dropdown-menu">
                  <li><a href="#validatesPresenceOf" rel="demo">presence</a></li>
                  <li><a href="#validatesLengthOf" rel="demo">length</a></li>
                  <li><a href="#validatesFormatOf" rel="demo">format</a></li>
                  <li><a href="#validatesNumericalityOf" rel="demo">numericality</a></li>
                  <li><a href="#validatesInclusionOf" rel="demo">inclusion</a></li>
                  <li><a href="#validatesExclusionOf" rel="demo">exclusion</a></li>
                  <li><a href="#validateCustom" rel="demo">custom</a></li>
                  <li><a href="#validateCustomAsync" rel="demo">custom async</a></li>
                  <li><a href="#validatesUniquenessOf" rel="demo">uniqueness</a></li>
                </ul>
              </li>
              <li><a href="#tip">Tip</a></li>
            </ul>
          </div>
        </div><!-- /topbar-inner -->
      </div><!-- /topbar -->
    </div><!-- /topbar-wrapper -->

<div class="container" id="container">
  <div class="page-header"><h1>Try JugglingDB</h1></div>

  <div class="row">

  <div class="span-one-half">

  <pre class="prettyprint">User = schema.define('User', {
    name:         String,
    bio:          Text,
    approved:     Boolean,
    joinedAt:     Date,
    age:          Number
});

Post = schema.define('Post', {
    title:     { type: String, length: 255 },
    content:   { type: Text },
    date:      { type: Date,    default: Date.now },
    published: { type: Boolean, default: false }
});

User.hasMany(Post,
    {as: 'posts', foreignKey: 'authorId'});</pre>

  </div>
  <div class="span-one-half">

    <div class="example" id="example" style="overflow: auto; width: 519px;">
      <form><strong class="jugg">jugglingdb></strong>
        <input name="console" class="console" autocomplete="off">
      </form>
    </div>

  </div>
</div>

<footer class="footer">
<div class="container">
  <p class="pull-right"><a href="#">Back to top</a></p>
  <p>
    Documentation written by <a href="http://twitter.com/1602">@1602 (Anatoliy Chakkaev)</a>.<br/>
    Built on <a href="http://twitter.github.com/bootstrap">Bootstrap</a> from Twitter<br/>
    RailwayJS code licensed under the <a href="http://www.opensource.org/licenses/mit-license.php" target="_blank">MIT License</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
  </p>
  <h6 style="text-align: center" id="tip">
    RailwayJS and JugglingDB projects are free, but you can leave a tip here:
  </h6>
  <form style="text-align: center" action="https://www.paypal.com/cgi-bin/webscr" method="post">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="hosted_button_id" value="J3JJDYJW78LEJ">
    <input type="image" style="box-shadow: none; -webkit-box-shadow: none; padding: 0; border: 0; width: 147px; height: 47px;" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/ru_RU/i/scr/pixel.gif" width="1" height="1">
  </form>
</div>
</footer>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23280347-1']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

</script>


<script type="text/jugglingdb" name="init">
  User = schema.define('User', {
      name:         String,
      bio:          Text,
      email:        String,
      approved:     Boolean,
      joinedAt:     Date,
      age:          Number,
      gender:       String,
      domain:       String
  });

  Post = schema.define('Post', {
      title:     { type: String },
      content:   { type: String },
      date:      { type: Date,    default: Date.now },
      published: { type: Boolean, default: false }
  });

  User.hasMany(Post, {as: 'posts', foreignKey: 'authorId'});
</script>

<script type="text/jugglingdb" name="validatesPresenceOf">
  Post.validatesPresenceOf('title');
  var post = new Post();
  post.isValid();
  post.title = 'Title';
  post.isValid();
</script>

<script type="text/jugglingdb" name="validatesLengthOf">
  Post.validatesLengthOf('content', {max: 10, allowBlank: true});
  var post = new Post();
  post.isValid();
  post.content = 'hey';
  post.isValid();
</script>

<script type="text/jugglingdb" name="validatesFormatOf">
  var checkEmail = /^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i;
  User.validatesFormatOf('email', {with: checkEmail});
  user = new User;
  user.isValid();
  user.email = 'anatoliy@example.com';
  user.isValid();
</script>

<script type="text/jugglingdb" name="validatesInclusionOf">
  User.validatesInclusionOf('gender', {in: ['male', 'female']});
  var u = new User({gender: 'male'});
  u.isValid();
  u.gender = 'girl';
  u.isValid();
</script>

<script type="text/jugglingdb" name="validatesExclusionOf">
  User.validatesExclusionOf('domain', {in: ['www', 'admin']});
  var u = new User;
  u.isValid();
  u.domain = 'www';
  u.isValid();
</script>

<script type="text/jugglingdb" name="validateCustom">
  var customValidator = function (err) { if (this.name === 'bad') err(); };
  User.validate('name', customValidator, {message: 'Bad name'});
  var user = new User({name: 'Peter'});
  user.isValid();
  user.name = 'bad';
  user.isValid();
</script>

<script type="text/jugglingdb" name="validateCustomAsync">
  var customValidatorAsync = function (err, done) { if (this.name === 'bad') err; setTimeout(done, 1000);};
  user = new User;
  user.isValid(c);
  user.name = 'bad';
  user.isValid(c);
</script>

<script type="text/jugglingdb" name="validatesUniquenessOf">
  User.validatesUniquenessOf('email');
  User.create({email: 'email@example.com'}, c);
  var u = new User({email: 'email@example.com'});
  u.isValid(c);
  u.email = 'unique@email.com';
  u.isValid(c);
</script>

<script type="text/jugglingdb" name="validatesNumericalityOf">
  User.validatesNumericalityOf('age', {int: true});
  var u = new User({age: 26.5});
  u.isValid();
  u.age = 26;
  u.isValid();
</script>

<script type="text/jugglingdb" name="validatesNumericalityOf">
  User.validatesNumericalityOf('age', {int: true});
  var u = new User({age: 26.5});
  u.isValid();
  u.age = 26;
  u.isValid();
</script>

</html>
